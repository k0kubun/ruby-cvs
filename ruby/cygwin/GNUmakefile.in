include Makefile

ARCH=@arch@
ENABLE_SHARED=@ENABLE_SHARED@

ifneq (,$(findstring no, $(ENABLE_SHARED)))
  DLL = dummy.exe
  DLLNAME = ruby.exe
  RUBYEXP = --output-exp=ruby.exp
  MAINOBJ := ruby.exp $(MAINOBJ)
  LIBRUBYARG := lib$(RUBY_INSTALL_NAME)s.a
else
  ifneq (,$(findstring mingw, $(ARCH)))
    DLL = rubymg.dll
    DLLNAME = rubymg.dll
  else
    DLL = rubycw.dll
    DLLNAME = rubycw.dll
  endif
  RUBYEXP =
endif

miniruby$(EXEEXT): $(DLL)

$(DLL): $(OBJS) dmyext.o
	$(LDSHARED) $(DLDFLAGS) -o $(DLL) --output-lib=$(LIBRUBY_SO) --dllname=$(DLLNAME) --add-stdcall-alias $(RUBYEXP) $(OBJS) dmyext.o $(LIBS)
