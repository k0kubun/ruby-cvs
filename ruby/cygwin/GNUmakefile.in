include Makefile

ENABLE_SHARED=@ENABLE_SHARED@

ifneq (,$(findstring no, $(ENABLE_SHARED)))
  EXTOBJS = $(RUBY_INSTALL_NAME).exp
  LIBRUBYARG = $(LIBRUBY_A)
endif

RUBYDEF = $(RUBY_INSTALL_NAME).def

$(LIBRUBY_SO): $(RUBYDEF)
$(LIBRUBY): $(LIBRUBY_SO)

$(RUBYDEF): $(LIBRUBY_A)
	echo EXPORTS > $(RUBYDEF)
	@NM@ --extern-only --defined-only $(LIBRUBY_A) | \
	  @MINIRUBY@ -ne 'puts $$1 if / [CDT] _(.*)$$/' >> $(RUBYDEF)
